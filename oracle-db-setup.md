# Oracle DB Setup for MyWebApp

## Create Redirect_data Table

```
CREATE TABLE "Redirect_data" (
    "Id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "Title" VARCHAR2(255) NOT NULL,
    "Description" VARCHAR2(4000) NOT NULL,
    "ForwardToUrl" VARCHAR2(2048) NOT NULL,
    "CreatedDateTime" TIMESTAMP,
    "LocationId" NUMBER NOT NULL,
    CONSTRAINT "FK_Redirect_data_Location" FOREIGN KEY ("LocationId") REFERENCES "LOCATION"("ID")
);
```

## Create RedirectLogs Table

```
CREATE TABLE "RedirectLogs" (
    "Id" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "ItemId" NUMBER NOT NULL,
    "IpAddress" VARCHAR2(45),
    "RedirectedAt" TIMESTAMP,
    CONSTRAINT "FK_RedirectLogs_Item" FOREIGN KEY ("ItemId") REFERENCES "Redirect_data"("Id")
);
```

## Create Location Table

```
CREATE TABLE "LOCATION" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "LOCATION_NAME" VARCHAR2(200) NOT NULL
);
```

## Update Existing Table (if table already exists)

If you have an existing table, run these commands to update it:

```
-- Remove the columns that are no longer needed
ALTER TABLE "Redirect_data" DROP COLUMN "CreatedByName";
ALTER TABLE "Redirect_data" DROP COLUMN "OwnSiteUrl";

-- Update existing records with NULL values (if any)
UPDATE "Redirect_data" SET "Title" = 'Untitled' WHERE "Title" IS NULL;
UPDATE "Redirect_data" SET "Description" = 'No description' WHERE "Description" IS NULL;
UPDATE "Redirect_data" SET "ForwardToUrl" = 'https://example.com' WHERE "ForwardToUrl" IS NULL;
UPDATE "Redirect_data" SET "LocationId" = 1 WHERE "LocationId" IS NULL;

-- Then alter the columns to NOT NULL
ALTER TABLE "Redirect_data" MODIFY ("Title" VARCHAR2(255) NOT NULL);
ALTER TABLE "Redirect_data" MODIFY ("Description" VARCHAR2(4000) NOT NULL);
ALTER TABLE "Redirect_data" MODIFY ("ForwardToUrl" VARCHAR2(2048) NOT NULL);
ALTER TABLE "Redirect_data" MODIFY ("LocationId" NUMBER NOT NULL);
```

## Update Existing Table (if LocationId was previously nullable)

If you have an existing table where LocationId was nullable, run this command:

```
-- First, update existing records with NULL LocationId to a default location
UPDATE "Redirect_data" SET "LocationId" = 1 WHERE "LocationId" IS NULL;

-- Then alter the column to NOT NULL
ALTER TABLE "Redirect_data" MODIFY ("LocationId" NUMBER NOT NULL);
```

## Drop Tables (if needed)

```
DROP TABLE "RedirectLogs";
DROP TABLE "Redirect_data";
DROP TABLE "LOCATION";
```

## Check for Table Existence

```
SELECT table_name FROM user_tables WHERE table_name = 'REDIRECT_DATA';
SELECT table_name FROM user_tables WHERE table_name = 'REDIRECTLOGS';
SELECT table_name FROM user_tables WHERE table_name = 'LOCATION';
```

## Describe Table Structure

```
DESC "Redirect_data";
DESC "RedirectLogs";
DESC "LOCATION";
```
